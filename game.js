// Core game logic with ghost fix and accurate collision